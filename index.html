<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Primăria Capitalei — Evidență Service-uri</title>
<link rel="icon" href="logo.png" type="image/png">
<style>
/* (păstrează tot CSS-ul tău actual) */
</style>
</head>
<body>
<div class="header">
  <img src="logo.png" alt="Logo Primaria" />
  <div class="header-text">
    <h2>PRIMĂRIA CAPITALEI</h2>
    <h1>Evidență Service-uri</h1>
  </div>
</div>

<div class="controls">
  <input id="search" type="search" placeholder="Caută după nume servis, proprietar, CNP, manager sau locație..." />
  <button id="btnAdd" class="btn">Adaugă înregistrare</button>
</div>

<div class="container">
  <div class="grid" id="grid"></div>
</div>

<!-- Modal Add/Edit -->
<div id="modal" class="modal" aria-hidden="true">
  <div class="modal-content">
    <button class="close" id="closeModal">&times;</button>
    <h2 id="modalTitle">Adaugă înregistrare servis</h2>
    <div id="form">
      <!-- Form fields: păstrează exact ce ai tu, inclusiv disponibil -->
    </div>
    <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
      <button id="save" class="btn">Salvează</button>
      <button id="cancel" class="btn gray">Anulează</button>
    </div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-analytics.js";
import {
  getFirestore, collection, addDoc, updateDoc, deleteDoc, doc, onSnapshot, query, orderBy
} from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBOjAkRl0gzmg6xolG33VmfIpMTskoaIAs",
  authDomain: "primarie-ac04b.firebaseapp.com",
  projectId: "primarie-ac04b",
  storageBucket: "primarie-ac04b.firebasestorage.app",
  messagingSenderId: "1074950947277",
  appId: "1:1074950947277:web:6741a815dd21a2e79b8484",
  measurementId: "G-7LGF8J9QJ3"
};

const app = initializeApp(firebaseConfig);
getAnalytics(app);
const db = getFirestore(app);
const servisCollection = collection(db, "servisuri");
const q = query(servisCollection, orderBy("createdAt", "desc"));

// DOM Elements
const grid = document.getElementById('grid');
const btnAdd = document.getElementById('btnAdd');
const modal = document.getElementById('modal');
const closeModal = document.getElementById('closeModal');
const saveBtn = document.getElementById('save');
const cancelBtn = document.getElementById('cancel');
const search = document.getElementById('search');

const servisName = document.getElementById('servisName');
const locationInput = document.getElementById('location');
const validitate = document.getElementById('validitate');
const ownerFull = document.getElementById('ownerFull');
const ownerCnp = document.getElementById('ownerCnp');
const ownerPhone = document.getElementById('ownerPhone');
const managerPhone = document.getElementById('managerPhone');
const managerCnp = document.getElementById('managerCnp');
const validitateChirie = document.getElementById('validitateChirie');
const penalizare = document.getElementById('penalizare');
const amenzi = document.getElementById('amenzi');
const mentiuni = document.getElementById('mentiuni');
const controlMedici = document.getElementById('controlMedici');
const controlPolitiei = document.getElementById('controlPolitiei');
const disponibilSelect = document.getElementById('disponibil');

let editId = null;

function closeModalFn() {
  modal.classList.remove('show');
  document.body.style.overflow = '';
}
closeModal.onclick = closeModalFn;
cancelBtn.onclick = closeModalFn;

btnAdd.onclick = () => {
  editId = null;
  modal.classList.add('show');
  document.body.style.overflow = 'hidden';
  document.querySelector('#modalTitle').textContent = 'Adaugă înregistrare servis';
  document.querySelectorAll('#form input, #form textarea').forEach(i => i.value = '');
  controlMedici.value = 'nu'; controlPolitiei.value = 'nu';
  disponibilSelect.value = 'Disponibil';
};

saveBtn.onclick = async () => {
  const name = servisName.value.trim();
  if(!name){alert('Completează numele servisului'); return;}
  const service = {
    name,
    location: locationInput.value.trim(),
    validitate: validitate.value,
    ownerFull: ownerFull.value.trim(),
    ownerCnp: ownerCnp.value.trim(),
    ownerPhone: ownerPhone.value.trim(),
    managerPhone: managerPhone.value.trim(),
    managerCnp: managerCnp.value.trim(),
    validitateChirie: validitateChirie.value,
    penalizare: penalizare.value,
    amenzi: amenzi.value,
    mentiuni: mentiuni.value,
    controlMedici: controlMedici.value,
    controlPolitiei: controlPolitiei.value,
    disponibil: disponibilSelect.value,
    photo: "logo.png",
    createdAt: Date.now()
  };

  try{
    if(editId){
      await updateDoc(doc(db, "servisuri", editId), service);
    } else {
      await addDoc(servisCollection, service);
    }
    closeModalFn();
  } catch(err){
    console.error(err);
    alert("A apărut o eroare la salvare.");
  }
};

// Listener in timp real
onSnapshot(q, (snapshot) => {
  const items = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
  renderItems(items);
});

function renderItems(items){
  const qStr = (search.value||'').toLowerCase();
  grid.innerHTML = '';
  items.forEach(it => {
    const hay = [it.name,it.location,it.ownerFull,it.ownerCnp,it.managerCnp].join(' ').toLowerCase();
    if(qStr && !hay.includes(qStr)) return;

    const card = document.createElement('div');
    card.className = 'card';
    const thumb = document.createElement('div');
    thumb.className = 'thumb';
    thumb.style.backgroundImage = `url(${it.photo})`;

    const h = document.createElement('h3'); h.textContent = it.name;
    const meta = document.createElement('div');
    meta.className = 'meta';
    meta.innerHTML = `<strong>Locație:</strong> ${it.location||'—'}<br>
                      <strong>Proprietar:</strong> ${it.ownerFull||'—'}<br>
                      <strong>Disponibil:</strong> ${it.disponibil||'—'}<br>
                      <strong>Manager:</strong> ${it.managerPhone||'—'}<br>
                      <strong>Control Medici:</strong> ${it.controlMedici} • <strong>Poliție:</strong> ${it.controlPolitiei}`;

    const actions = document.createElement('div');
    actions.className = 'actions';
    const openBtn = document.createElement('button');
    openBtn.className = 'btn gray';
    openBtn.textContent = 'Deschide';
    openBtn.onclick = ()=>openEdit(it);

    const delBtn = document.createElement('button');
    delBtn.className = 'btn danger';
    delBtn.textContent = 'Șterge';
    delBtn.onclick = async ()=>{ if(confirm('Ștergi această înregistrare?')) await deleteDoc(doc(db,"servisuri",it.id)); };

    actions.append(openBtn, delBtn);
    card.append(thumb,h,meta,actions);
    grid.appendChild(card);
  });

  if(!grid.children.length)
    grid.innerHTML='<div style="grid-column:1/-1;padding:16px;background:rgba(255,255,255,0.05);border-radius:8px;color:#ccc">Nu există înregistrări</div>';
}

function openEdit(it){
  editId = it.id;
  document.querySelector('#modalTitle').textContent = 'Editează înregistrare';
  servisName.value = it.name||'';
  locationInput.value = it.location||'';
  validitate.value = it.validitate||'';
  ownerFull.value = it.ownerFull||'';
  ownerCnp.value = it.ownerCnp||'';
  ownerPhone.value = it.ownerPhone||'';
  managerPhone.value = it.managerPhone||'';
  managerCnp.value = it.managerCnp||'';
  validitateChirie.value = it.validitateChirie||'';
  penalizare.value = it.penalizare||'';
  amenzi.value = it.amenzi||'';
  mentiuni.value = it.mentiuni||'';
  controlMedici.value = it.controlMedici||'nu';
  controlPolitiei.value = it.controlPolitiei||'nu';
  disponibilSelect.value = it.disponibil||'Disponibil';
  modal.classList.add('show'); document.body.style.overflow='hidden';
}

search.oninput = () => renderItems([]); // filtrare simplă, poți integra cu items dacă vrei

</script>
</body>
</html>
