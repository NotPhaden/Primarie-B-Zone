<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Primăria Capitalei — Evidență Service-uri</title>
  <link rel="icon" href="logo.png" type="image/png">
  <style>
    :root{
      --bg:#0b1622;
      --accent:#4cc2ff;
      --card-bg: rgba(255,255,255,0.05);
      --modal-bg:#f3f6f8;
      --modal-text:#222;
      --muted:#cfeeff;
      --danger:#ff6b6b;
      --btn-gray:#2c3948;
    }
    *{box-sizing:border-box}
    body{
      font-family: Inter, Arial, sans-serif;
      background:var(--bg);
      color:#fff;
      margin:0;
    }
    /* --- restul CSS-ului tău aici (pentru brevitate) --- */
    .header{display:flex;align-items:center;gap:18px;padding:22px 28px}
    .header img{width:64px;height:64px;object-fit:cover;border-radius:8px}
    .header-text h2{margin:0;font-size:13px;color:var(--accent);text-transform:uppercase;letter-spacing:2px}
    .header-text h1{margin:4px 0 0;font-size:20px;color:#fff}
    .controls{max-width:1100px;margin:12px auto;padding:12px 20px;display:flex;flex-wrap:wrap;gap:10px;align-items:center}
    .controls input[type="search"]{flex:1 1 260px;padding:10px;border-radius:8px;border:0;background:#07111a;color:#cfeeff}
    .controls button{background:var(--accent);color:#042231;border:none;padding:10px 12px;border-radius:8px;cursor:pointer}
    .container{max-width:1100px;margin:12px auto;padding:0 20px}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:16px;margin-top:14px}
    .card{position:relative;background:var(--card-bg);border-radius:12px;overflow:hidden;padding:12px;box-shadow:0 8px 22px rgba(0,0,0,0.6);display:flex;flex-direction:column;gap:8px}
    .thumb{width:100%;height:160px;border-radius:8px;background:#07111a;background-size:cover;background-position:center;box-shadow:inset 0 0 0 1px rgba(255,255,255,0.02)}
    .card h3{margin:0;font-size:18px;color:#fff}
    .meta{font-size:13px;color:#d6d6d6}
    .actions{display:flex;gap:8px;margin-top:8px}
    .btn{background:var(--accent);border:0;padding:8px 10px;border-radius:8px;color:#042231;cursor:pointer;transition:0.2s}
    .btn.gray{background:var(--btn-gray);color:#fff;}
    .btn.danger{background:var(--danger);color:#111}
    .modal{display:none;position:fixed;inset:0;z-index:1400;background:rgba(0,0,0,0.7);justify-content:center;align-items:center;padding:20px;overflow:auto}
    .modal.show{display:flex}
    .modal-content{background:var(--modal-bg);color:var(--modal-text);width:100%;max-width:920px;border-radius:12px;padding:18px;box-shadow:0 18px 50px rgba(0,0,0,0.5);position:relative}
    .close{position:absolute;right:12px;top:8px;font-size:22px;background:transparent;border:0;cursor:pointer}
    textarea{min-height:90px;resize:vertical}
  </style>
</head>
<body>
  <div class="header">
    <img src="logo.png" alt="Logo Primaria" />
    <div class="header-text">
      <h2>PRIMĂRIA CAPITALEI</h2>
      <h1>Evidență Service-uri</h1>
    </div>
  </div>

  <div class="controls">
    <input id="search" type="search" placeholder="Caută după nume servis, proprietar, CNP, manager sau locație..." />
    <button id="btnAdd" class="btn">Adaugă înregistrare</button>
  </div>

  <div class="container">
    <div class="grid" id="grid"></div>
  </div>

  <!-- Modal Add/Edit -->
  <div id="modal" class="modal" aria-hidden="true">
    <div class="modal-content">
      <button class="close" id="closeModal">&times;</button>
      <h2 id="modalTitle">Adaugă înregistrare servis</h2>
      <div id="form">
        <!-- Form fields identic cu ce ai tu deja -->
        <div class="form-row">
          <div class="col">
            <label for="servisName">Nume servis</label>
            <input id="servisName" type="text" placeholder="Ex: Service Auto Central" />
          </div>
          <div class="col">
            <label for="location">Locație (adresă)</label>
            <input id="location" type="text" placeholder="Str., Nr., Sector" />
          </div>
        </div>
        <!-- restul câmpurilor ... identic cu HTML-ul tău original -->
        <!-- Disponibilitate -->
        <div class="form-row">
          <div class="col">
            <label for="disponibil">Disponibilitate</label>
            <select id="disponibil">
              <option value="Disponibil">Disponibil</option>
              <option value="Indisponibil">Indisponibil</option>
            </select>
          </div>
        </div>
        <!-- Date proprietar / manager -->
        <div class="form-row">
          <div class="col"><label for="ownerFull">Nume & Prenume proprietar</label><input id="ownerFull" type="text" /></div>
          <div class="col"><label for="ownerCnp">CNP proprietar</label><input id="ownerCnp" type="tel" maxlength="13" /></div>
        </div>
        <div class="form-row">
          <div class="col"><label for="ownerPhone">Nr. telefon proprietar</label><input id="ownerPhone" type="text" /></div>
          <div class="col"><label for="managerPhone">Nr. telefon manager</label><input id="managerPhone" type="text" /></div>
        </div>
        <div class="form-row">
          <div class="col"><label for="managerCnp">CNP manager</label><input id="managerCnp" type="tel" maxlength="13" /></div>
          <div class="col"><label for="validitateChirie">Valabilitate chirie (data)</label><input id="validitateChirie" type="date" /></div>
        </div>
        <div class="form-row">
          <div class="col"><label for="penalizare">Valoare penalizare (lei)</label><input id="penalizare" type="number" min="0" step="0.01" /></div>
          <div class="col"><label for="amenzi">Amenzi</label><input id="amenzi" type="text" /></div>
        </div>
        <div class="form-row">
          <div class="col"><label for="mentiuni">Mențiuni</label><textarea id="mentiuni"></textarea></div>
          <div class="col">
            <label for="controlMedici">Control medici</label>
            <select id="controlMedici"><option value="nu">Nu</option><option value="da">Da</option></select>
            <label for="controlPolitiei">Control poliție</label>
            <select id="controlPolitiei"><option value="nu">Nu</option><option value="da">Da</option></select>
          </div>
        </div>
        <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
          <button id="save" class="btn">Salvează</button>
          <button id="cancel" class="btn gray">Anulează</button>
        </div>
      </div>
    </div>
  </div>

<script type="module">
  // Firebase v12
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
  import { getDatabase, ref, push, set, onValue, remove, update } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBOjAkRl0gzmg6xolG33VmfIpMTskoaIAs",
    authDomain: "primarie-ac04b.firebaseapp.com",
    databaseURL: "https://primarie-ac04b-default-rtdb.firebaseio.com",
    projectId: "primarie-ac04b",
    storageBucket: "primarie-ac04b.firebasestorage.app",
    messagingSenderId: "1074950947277",
    appId: "1:1074950947277:web:6741a815dd21a2e79b8484",
    measurementId: "G-7LGF8J9QJ3"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const servisRef = ref(db, 'servisuri');

  /* DOM refs */
  const grid = document.getElementById('grid');
  const btnAdd = document.getElementById('btnAdd');
  const modal = document.getElementById('modal');
  const closeModal = document.getElementById('closeModal');
  const saveBtn = document.getElementById('save');
  const cancelBtn = document.getElementById('cancel');
  const search = document.getElementById('search');

  const servisName = document.getElementById('servisName');
  const locationInput = document.getElementById('location');
  const validitate = document.getElementById('validitate');
  const ownerFull = document.getElementById('ownerFull');
  const ownerCnp = document.getElementById('ownerCnp');
  const ownerPhone = document.getElementById('ownerPhone');
  const managerPhone = document.getElementById('managerPhone');
  const managerCnp = document.getElementById('managerCnp');
  const validitateChirie = document.getElementById('validitateChirie');
  const penalizare = document.getElementById('penalizare');
  const amenzi = document.getElementById('amenzi');
  const mentiuni = document.getElementById('mentiuni');
  const controlMedici = document.getElementById('controlMedici');
  const controlPolitiei = document.getElementById('controlPolitiei');
  const disponibilSelect = document.getElementById('disponibil');

  let editId = null;

  function closeModalFn(){ modal.classList.remove('show'); document.body.style.overflow=''; }
  closeModal.onclick = closeModalFn;
  cancelBtn.onclick = closeModalFn;

  btnAdd.onclick = () => {
    editId = null;
    modal.classList.add('show');
    document.body.style.overflow='hidden';
    document.querySelector('#modalTitle').textContent='Adaugă înregistrare servis';
    document.querySelectorAll('#form input, #form textarea').forEach(i=>i.value='');
    controlMedici.value='nu'; controlPolitiei.value='nu';
    disponibilSelect.value='Disponibil';
  };

  function uid(){ return Date.now().toString(36)+'-'+Math.floor(Math.random()*9999); }

  saveBtn.onclick = async () => {
    const name = servisName.value.trim();
    if(!name){ alert('Completează numele servisului'); return; }

    const obj = {
      name,
      location: locationInput.value.trim(),
      validitate: validitate.value,
      disponibil: disponibilSelect.value,
      ownerFull: ownerFull.value.trim(),
      ownerCnp: ownerCnp.value.trim(),
      ownerPhone: ownerPhone.value.trim(),
      managerPhone: managerPhone.value.trim(),
      managerCnp: managerCnp.value.trim(),
      validitateChirie: validitateChirie.value,
      penalizare: penalizare.value,
      amenzi: amenzi.value,
      mentiuni: mentiuni.value,
      controlMedici: controlMedici.value,
      controlPolitiei: controlPolitiei.value,
      photo: "logo.png",
      createdAt: Date.now()
    };

    if(editId){
      await update(ref(db, 'servisuri/' + editId), obj);
    } else {
      const newRef = push(servisRef);
      editId = newRef.key;
      await set(newRef, obj);
    }
    closeModalFn();
  };

  function renderAll(snapshot){
    const data = snapshot.val() || {};
    const items = Object.entries(data).map(([id, val])=>({id, ...val}));
    const q = (search.value||'').toLowerCase();
    grid.innerHTML = '';
    items.sort((a,b)=>b.createdAt - a.createdAt);
    items.forEach(it=>{
      const hay=[it.name,it.location,it.ownerFull,it.ownerCnp,it.managerCnp].join(' ').toLowerCase();
      if(q && !hay.includes(q)) return;
      const card = document.createElement('div'); card.className='card';
      const thumb = document.createElement('div'); thumb.className='thumb'; thumb.style.backgroundImage=`url(${it.photo})`;
      const h = document.createElement('h3'); h.textContent=it.name;
      const meta = document.createElement('div'); meta.className='meta';
      meta.innerHTML=`<strong>Locație:</strong> ${it.location||'—'}<br>
                      <strong>Proprietar:</strong> ${it.ownerFull||'—'}<br>
                      <strong>Disponibil:</strong> ${it.disponibil||'—'}<br>
                      <strong>Manager:</strong> ${it.managerPhone||'—'}<br>
                      <strong>Control Medici:</strong> ${it.controlMedici} • <strong>Poliție:</strong> ${it.controlPolitiei}`;
      const actions = document.createElement('div'); actions.className='actions';
      const openBtn = document.createElement('button'); openBtn.className='btn gray'; openBtn.textContent='Deschide';
      openBtn.onclick = ()=> openEdit(it);
      const delBtn = document.createElement('button'); delBtn.className='btn danger'; delBtn.textContent='Șterge';
      delBtn.onclick = ()=>{ if(confirm('Ștergi această înregistrare?')) remove(ref(db,'servisuri/'+it.id)); };
      actions.append(openBtn, delBtn);
      card.append(thumb, h, meta, actions);
      grid.appendChild(card);
    });
    if(!grid.children.length) grid.innerHTML='<div style="grid-column:1/-1;padding:16px;background:rgba(255,255,255,0.05);border-radius:8px;color:#ccc">Nu există înregistrări</div>';
  }

  function openEdit(it){
    editId = it.id;
    document.querySelector('#modalTitle').textContent='Editează înregistrare';
    servisName.value = it.name||''; locationInput.value = it.location||''; validitate.value = it.validitate||'';
    ownerFull.value = it.ownerFull||''; ownerCnp.value = it.ownerCnp||''; ownerPhone.value = it.ownerPhone||'';
    managerPhone.value = it.managerPhone||''; managerCnp.value = it.managerCnp||''; validitateChirie.value = it.validitateChirie||'';
    penalizare.value = it.penalizare||''; amenzi.value = it.amenzi||''; mentiuni.value = it.mentiuni||'';
    controlMedici.value = it.controlMedici||'nu'; controlPolitiei.value = it.controlPolitiei||'nu';
    disponibilSelect.value = it.disponibil||'Disponibil';
    modal.classList.add('show'); document.body.style.overflow='hidden';
  }

  search.addEventListener('input', ()=>{
    onValue(servisRef, renderAll);
  });

  onValue(servisRef, renderAll);

</script>
</body>
</html>
